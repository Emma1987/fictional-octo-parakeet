# Deploying to Digital Ocean's App Platform

Digital Ocean's App Platform is a Platform as as Service, allowing you to 
provide your application's code and let them take care of the web hosting.

Amongst other things, it offers: 

- Automated deployments with no downtime;
- Vertical and horizontal scaling;
- Built-in load balancing;
- Secure integration with DO's Managed Databases.

So, let's look at how you can deploy your application on DO's App Platform.


## MySQL database

The first thing you'll want to set up is a Managed MySQL Database cluster. 

Digital Ocean's [Official Documentation on Managed MySQL Databases](https://docs.digitalocean.com/products/databases/mysql/how-to/) 
will walk you through everything you need to set up your first MySQL cluster.

**⚠️ Important notes:** 
- If your project uses a shared database cluster instead of having its own 
  cluster, make sure you [create a database user that only has access to the project's database](https://www.digitalocean.com/community/questions/native-authentication-user-grant-access-to-a-single-database).
- You'll likely want to disable the `ANSI_QUOTES` MySQL option on your 
  managed databases (in `Database > Settings > Global SQL mode`)

## Redis database (user sessions)

Just like with the MySQL database, you'll want to create a Redis database 
cluster and database.

Once again, Digital Ocean's [Official Documentation on Managed Redis Databases](https://docs.digitalocean.com/products/databases/redis/how-to/) 
will walk you through everything you need to set up your first Redis cluster.

## Application

Once you have your MySQL and Redis databases ready, you're all set to create
your application.

1. In Digital Ocean, click the "Create" button and select "Apps".
2. Choose the GitHub service provider, and select your project's repository.
3. Select the branch that contains your production-ready code.
4. Leave "Autodeploy" on. 
   - Your app will re-deploy everytime new commits are pushed to that branch. 
5. In the next section, make sure your app only contains one web service.
   - If multiple are shown, only keep the one that says `Dockerfile`.
6. Configure your web service 
   - Use the HTTP Port `80`. 
   - Leave the other settings to their default value.
7. Change your plan ("Edit plan") to run only **one** container, at whatever
   size you need for your application.
   - The smallest size should work fine for testing purposes. Adjust based on 
     your needs.
8. In the next section, configure your environment variables for the app.
   - Don't forget to use your DO Managed Databases's for MySQL and Redis.
   - The `SERVER_NAME` should specify port 80, to prevent Caddy from handling SSL generation.
     - For example: `app.domain.com:80`
     - DO's App Platform handles the SSL certificate in a layer above the app, 
       so our service can run as HTTP under the hood.
   - If you use Symfony secrets, you'll want to make sure you provide
     a `SYMFONY_DECRYPTION_SECRET` variable, as indicated by [Symfony's docs](https://symfony.com/doc/current/configuration/secrets.html#deploy-secrets-to-production).
   - You must provide a value for `MERCURE_PUBLISHER_JWT_KEY` and 
     `MERCURE_SUBSCRIBER_JWT_KEY`, even if you do not use Mercure.
   - Check out this template's [Environment variables docs](/docs/usage/configuration/environment-variables.md) for more info.
9. Go through the rest of the setup and create your app! 🎉

### Configuring your domain

Once your app has been setup, you'll want to point your domain name to it.

To do so, edit your domain's DNS records to create a CNAME that points to the
automatically generated hostname generated by DO's App Platform (ex.: `my-app-jvb8b.ondigitalocean.app`).

Then, add your domain name to your Digital Ocean App (Settings > Domains > Add Domain).

Once that's done, you should be all set! 
